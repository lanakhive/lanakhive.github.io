"use strict";var container=document.createElement("div");container.style.width="100%";container.style.height="100%";container.style.position="relative";container.id="linesdemo";var canvas=document.createElement("canvas");canvas.style.width="100%";canvas.style.height="100%";canvas.style.backgroundColor="rgb(13,10,10)";canvas.mozOpaque=true;container.appendChild(canvas);var scripts=document.getElementsByTagName("script");var script=scripts[scripts.length-1];script.parentNode.insertBefore(container,script);canvas.width=canvas.getBoundingClientRect().width;canvas.height=canvas.getBoundingClientRect().height;var ctx=canvas.getContext("2d");window.addEventListener("resize",function(){figuresize()},false);if(canvas.mozRequestFullScreen){var but=document.createElement("button");but.innerHTML="â–¡";but.style.cssText="width:30px;height:30px;margin:10px;padding:0;position:absolute;bottom:0;right:0;background:#444;border:1px solid;border-radius:0;color:#eee;box-shadow:none;font:20px sans-serif;text-align:center;opacity:.5;-moz-user-select:none;-webkit-user-select: none";container.appendChild(but);but.addEventListener("click",function(){console.log("Enter fullscreen");canvas.mozRequestFullScreen()})}function randI(b,a){b=Math.ceil(b);a=Math.floor(a);return Math.floor(Math.random()*(a-b+1))+b}function randB(){return Math.random()>=0.5}function rads(a){return a*(Math.PI/180)}var env={xcount:10,ycount:10,cradius:25,cgap:25,thickness:8,thingcount:30,offset:0,timescale:1};var things=[];var bgpattern=(function createBG(){var a=document.createElement("canvas");var b=a.getContext("2d");a.width=2*env.cradius+env.cgap;a.height=2*env.cradius+env.cgap;b.fillStyle="rgb(13,10,10)";b.fillRect(0,0,a.width,a.height);var c=2*env.cradius+env.cgap;b.strokeStyle="rgb(25,20,20)";b.lineWidth=env.thickness;b.beginPath();b.arc(0,0,env.cradius,2*Math.PI,false);b.stroke();b.beginPath();b.arc(0,c,env.cradius,0,2*Math.PI,false);b.stroke();b.beginPath();b.arc(c,0,env.cradius,0,2*Math.PI,false);b.stroke();b.beginPath();b.arc(c,c,env.cradius,0,2*Math.PI,false);b.stroke();b.fillStyle="rgb(18,15,15)";b.beginPath();b.arc(0,0,env.cradius/2,0,2*Math.PI,false);b.fill();b.beginPath();b.arc(0,c,env.cradius/2,0,2*Math.PI,false);b.fill();b.beginPath();b.arc(c,0,env.cradius/2,0,2*Math.PI,false);b.fill();b.beginPath();b.arc(c,c,env.cradius/2,0,2*Math.PI,false);b.fill();var d=ctx.createPattern(a,"repeat");return d})();function createCSeg(d,c,b,a,e){return{typ:1,x:d,y:c,d:b,ds:b,cw:a,dend:e}}function createLSeg(g,e,a,h,f,b,c,i,d){return{typ:2,fromx:g,fromy:e,fromd:a,tox:h,toy:f,tod:b,x:g,y:e,tocw:c,tonx:i,tony:d}}function gowhere(e,b){if(e==null){console.error("No angle?")}while(e>=360){e=e-360}while(e<0){e=e+360}var c,a;var d=e;var g=randI(1,2);if(e==0){c=0;a=1}else{if(e==45){c=-1;a=1}else{if(e==90){c=-1;a=0}else{if(e==135){c=-1;a=-1}else{if(e==180){c=0;a=-1}else{if(e==225){c=1;a=-1}else{if(e==270){c=1;a=0}else{if(e==315){c=1;a=1}}}}}}}}if(!b){c=-c;a=-a}c=c*g;a=a*g;var f=false;if(randB()){if(e==45&&b){c=0;a=1;d=225;f=true}else{if(e==135&&b){c=-1;a=0;d=315;f=true}else{if(e==225&&b){c=0;a=-1;d=45;f=true}else{if(e==315&&b){c=1;a=0;d=135;f=true}else{if(e==45&&!b){c=1;a=0;d=225;f=true}else{if(e==135&&!b){c=0;a=1;d=315;f=true}else{if(e==225&&!b){c=-1;a=0;d=45;f=true}else{if(e==315&&!b){c=0;a=-1;d=135;f=true}}}}}}}}}return{ox:c,oy:a,newr:d,flip:f}}function addSegment(p){var f;var l=p.parts[0];if(l==null){console.error("No things?")}if(l.typ==1){var d=l.x*(2*env.cradius+env.cgap)+Math.cos(rads(l.dend))*env.cradius;var c=l.y*(2*env.cradius+env.cgap)+Math.sin(rads(l.dend))*env.cradius;var a=l.dend;var k,i,j,h;var q=gowhere(a,l.cw);k=q.ox;i=q.oy;j=q.newr;h=q.flip;if(k+l.x<0||k+l.x>env.xcount||i+l.y<0||i+l.y>env.ycount){if(k>0){k=1}if(i>0){i=1}if(k<0){k=-1}if(i<0){i=-1}}k=l.x+k;i=l.y+i;var b=l.cw;if(h){b=!b}var o=k*(2*env.cradius+env.cgap)+Math.cos(rads(j))*env.cradius;var n=i*(2*env.cradius+env.cgap)+Math.sin(rads(j))*env.cradius;f=createLSeg(d,c,a,o,n,j,b,k,i);p.parts.unshift(f);return}if(l.typ==2){var m=l.tod;while(m>=360){m=m-360}while(m<0){m=m+360}var g=45*(randI(1,4));if(l.tonx==0||l.tonx==env.xcount||l.tony==0||l.tony==env.ycount){g=45*4}var e=l.tocw;if(e){g=m+g}if(!e){g=m-g}f=createCSeg(l.tonx,l.tony,m,e,g);p.parts.unshift(f);return}}function removeSegment(a){a.parts.pop()}function createThing(d,c){var e={speed:100+randI(1,40),endspeed:10,parts:[],color:[randI(128,255),randI(128,255),randI(128,255)]};var b=randB();var a=45*randI(0,7);var f=45*randI(1,4);if(b){f=a+f}if(!b){f=a-f}e.parts.push(createCSeg(d,c,a,b,f));return e}function updateThing(h,a){var f=env.timescale;var c=h.speed;var d=h.endspeed;var i=false;var e=false;if(h.parts.length==0){return}var b=h.parts[0];if(b.typ==1){if(b.cw){b.d=b.d+c*a*4*f;if(b.d>b.dend){b.d=b.dend;i=true}}else{b.d=b.d-c*a*4*f;if(b.d<b.dend){b.d=b.dend;i=true}}}else{if(b.typ==2){var k=Math.abs(b.fromx-b.tox);var j=Math.abs(b.fromy-b.toy);var g=k/j;if(k==0||j==0){g=1}if(b.tox>b.fromx){b.x=b.x+c*a*g*f;if(b.x>=b.tox){b.x=b.tox;i=true}}else{if(b.tox<b.fromx){b.x=b.x-c*a*g*f;if(b.x<=b.tox){b.x=b.tox;i=true}}}if(b.toy>b.fromy){b.y=b.y+c*a*1*f;if(b.y>=b.toy){b.y=b.toy;i=true}}else{if(b.toy<b.fromy){b.y=b.y-c*a*1*f;if(b.y<=b.toy){b.y=b.toy;i=true}}}}}b=h.parts[h.parts.length-1];if(b.typ==1){if(b.cw){b.ds=b.ds+d*a*4*f;if(b.ds>b.d){e=true}}else{b.ds=b.ds-d*a*4*f;if(b.ds<b.d){e=true}}}else{if(b.typ==2){var k=Math.abs(b.fromx-b.tox);var j=Math.abs(b.fromy-b.toy);var g=k/j;if(k==0||j==0){g=1}if(b.tox>b.fromx){b.fromx=b.fromx+d*a*g*f;if(b.fromx>=b.x){e=true}}else{if(b.tox<b.fromx){b.fromx=b.fromx-d*a*g*f;if(b.fromx<=b.x){e=true}}}if(b.toy>b.fromy){b.fromy=b.fromy+d*a*1*f;if(b.fromy>=b.y){e=true}}else{if(b.toy<b.fromy){b.fromy=b.fromy-d*a*1*f;if(b.fromy<=b.y){e=true}}}}}if(i){addSegment(h)}if(e){removeSegment(h)}h.speed=h.speed+35*a*f;if(h.speed>200){h.speed=200}h.endspeed=h.endspeed+45*a*f;if(h.endspeed>220){h.endspeed=240}}function drawThing(n){var d=env.offset;var b=env.cradius;var k=env.cgap;ctx.strokeStyle="rgb("+n.color[0]+","+n.color[1]+","+n.color[2]+")";ctx.beginPath();for(var h=0;h<n.parts.length;h++){var c=n.parts[h];if(c.typ==1){var m=c.x;var l=c.y;var j=c.ds;var f=c.d;var e=false;if(j>f){e=true}var a=d+m*(2*b+k);var o=d+l*(2*b+k);ctx.moveTo(a+env.cradius*Math.cos(rads(j)),o+env.cradius*Math.sin(rads(j)));ctx.arc(a,o,env.cradius,rads(j),rads(f),e)}else{if(c.typ==2){ctx.moveTo(d+c.fromx,d+c.fromy);ctx.lineTo(d+c.x,d+c.y)}}}ctx.stroke()}function update(b){for(var a=0;a<things.length;a++){updateThing(things[a],b)}if(things.length<env.thingcount){if(randI(1,30)==10){things.push(createThing(randI(3,env.xcount-3),randI(3,env.ycount-3)))}}for(var a=0;a<things.length;a++){if(things[a].parts.length==0){things.splice(a,1)}}}function draw(d){var f=env.offset;var c=env.cradius;var b=env.cgap;var e=d;ctx.fillStyle=bgpattern;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.lineWidth=env.thickness;ctx.lineCap="round";for(var a=0;a<things.length;a++){drawThing(things[a])}if(false){ctx.font="12px sans-serif";ctx.fillStyle="rgb(100,100,100)";ctx.textBaseline="top";ctx.fillText("Things: "+things.length+"/"+env.thingcount,10,10);ctx.fillText("FPS: "+(1/d).toFixed(2)+" ("+(d*1000).toFixed(2)+"ms)",10,25)}}function figuresize(){canvas.width=canvas.getBoundingClientRect().width;canvas.height=canvas.getBoundingClientRect().height;console.log("Resize");var a=canvas.width;var b=canvas.height;env.xcount=Math.ceil(a/(2*env.cradius+env.cgap))-1;env.ycount=Math.ceil(b/(2*env.cradius+env.cgap))-1;env.offset=0}function run(){console.log("starting run");figuresize();var d=Date.now();var a=0;var c=0;window.requestAnimationFrame(b);function b(e){c=e-a;a=e;if(c<0){c=0}c=c/1000;update(c);draw(c);window.requestAnimationFrame(b)}}run();