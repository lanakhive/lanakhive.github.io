local a={}local b=100;local c=1024;local d=64;local e=10;local f=30;local g;local h;local i;local j;local k;local l;local m;local n;local o;local p;local q;local r;local s={}function a.listLength()return#s end;local function t(u,v)local w=love.graphics.newCanvas(u,v)love.graphics.setCanvas(w)for x=0,v do local y=x/(v/255)love.graphics.setColor(255,255,255,y)love.graphics.line(0,x,u,x)end;love.graphics.reset()return w end;local function z(A)local B=love.graphics.getHeight()/2;local w=love.graphics.newCanvas(A,B)love.graphics.setCanvas(w)for x=0,B do local y=x/(B/255)love.graphics.setColor(0,0,0,y)love.graphics.line(0,x,A,x)end;love.graphics.reset()return w end;local function C(A)local B=love.graphics.getHeight()/4;local w=love.graphics.newCanvas(A,B)love.graphics.setCanvas(w)for x=0,B do local y=255-x/(B/255)love.graphics.setColor(0,0,0,y*0.5)love.graphics.line(0,x,A,x)end;love.graphics.reset()return w end;local function D(E)for x=#E,1,-1 do local y=math.random(x)E[y],E[x]=E[x],E[y]end end;local function F()local G={{255,40,100},{255,255,0},{255,150,0},{150,0,255},{150,255,100},{255,0,200},{40,100,255}}D(G)local y=math.random(3,5)for x=y+1,#G do G[x]=nil end;return G end;local function H(w,A,B)local function I(w,J,x)return w+(J-w)*x end;local G=F()love.graphics.reset()love.graphics.setCanvas(w)local K=A/#G;local L=math.ceil(2*K/3)local M=math.ceil(K/3)local u=0;for x=1,#G do local N=G[x]local O=G[x+1]if not O then O=G[1]end;for P=1,L do love.graphics.setColor(N)love.graphics.line(u,0,u,B)u=u+1 end;for P=1,M do local Q=P/M;local R=love.math.gammaToLinear;local S=love.math.linearToGamma;love.graphics.setColor(S(I(R(N[1]),R(O[1]),Q)),S(I(R(N[2]),R(O[2]),Q)),S(I(R(N[3]),R(O[3]),Q)))love.graphics.line(u,0,u,B)u=u+1 end end;love.graphics.reset()return w end;local function T()g=b*love.graphics.getWidth()/100;while#s<g do local E={}E.x=math.random(0,love.graphics.getWidth())E.y=math.random(0-c,love.graphics.getHeight())E.sp=5*math.random()+3;E.op=math.random(25,255)E.tip=false;E.alpha=math.random(25,100)if math.random(1,10)==10 then E.tip=true;E.alpha=220 end;table.insert(s,E)end;while#s>g do table.remove(s)end;o=love.graphics.newSpriteBatch(h,g)p=love.graphics.newSpriteBatch(i,g)for x,P in ipairs(s)do o:setColor(255,255,255,P.alpha)P.id=o:add(P.x,P.y)if P.tip then p:setColor(255,255,255,160)P.ids=p:add(P.x,P.y)end end end;function a.init()h=t(2,c)i=t(2,d)j=z(love.graphics.getWidth())k=C(love.graphics.getWidth())l=love.graphics.newCanvas()m=love.graphics.newCanvas()l=H(l,love.graphics.getWidth(),love.graphics.getHeight())m=H(m,love.graphics.getWidth(),love.graphics.getHeight())n=love.graphics.newCanvas()s={}T()q=0;r=true end;function a.update(U)for x,P in ipairs(s)do P.y=P.y+P.sp*e*U;if P.y>love.graphics.getHeight()then P.y=0-c end;o:setColor(255,255,255,P.alpha)o:set(P.id,P.x,P.y)if P.tip then p:setColor(255,255,255,160)p:set(P.ids,P.x,P.y+c-d)end end;if r==true then q=q+f*U else q=q-f*U end;if q>255 then q=255;r=false;l=H(l,love.graphics.getWidth(),love.graphics.getHeight())end;if q<0 then q=0;r=true;m=H(m,love.graphics.getWidth(),love.graphics.getHeight())end end;function a.draw()love.graphics.reset()love.graphics.draw(o)love.graphics.reset()love.graphics.draw(k,0,0,0,1,1)love.graphics.reset()love.graphics.setCanvas(n)love.graphics.draw(l,0,0)love.graphics.setColor(255,255,255,q)love.graphics.draw(m,0,0)love.graphics.reset()love.graphics.setBlendMode('multiply')love.graphics.draw(n,0,0)love.graphics.reset()love.graphics.reset()love.graphics.draw(p)love.graphics.reset()love.graphics.draw(j,0,love.graphics.getHeight()-j:getHeight())end;function a.getLineCount()return b end;function a.setLineCount(V)if V~=b then b=V;T()end end;function a.getLineHeight()return c end;function a.setLineHeight(V)if V~=c then oldheight=c;c=V;if c<128 then d=c/2 else d=64 end;h=t(2,c)i=t(2,d)o:setTexture(h)p:setTexture(i)for x,P in ipairs(s)do P.y=P.y+oldheight-c end end end;function a.getLineSpeed()return e end;function a.setLineSpeed(V)if V~=e then e=V/3 end end;function a.getColorSpeed()return f end;function a.setColorSpeed(V)if V~=f then f=V end end;return alocal a=require('line')local b=require('kavarki')function love.load()math.randomseed(os.time())a.init()end;function love.resize(c,d)a.init()end;function love.update(e)if e>1 then e=0 end;a.update(e)end;function love.draw()a.draw()love.graphics.reset()if showdebug then local f=math.floor(collectgarbage('count'))love.graphics.print("Chroma Drencher\nFPS: "..love.timer.getFPS().."\nLines: "..a.listLength(),20,20)b.start{mousex=love.mouse.getX(),mousey=love.mouse.getY(),mousel=love.mouse.isDown(1)}b.hpadding(80)b.wpadding(20)b.nextLine()local function g(h,i,j,k,l,m)b.hpadding(20)b.wpadding(20)b.label{text=i,w=50,h=20}j=b.slider{id=h,hor=true,val=j,range=0,min=k,max=l}m(j)b.nextLine()return j end;linecount=linecount or a.getLineCount()linecount=g(1,'Lines',linecount,1,400,a.setLineCount)lineheight=lineheight or a.getLineHeight()lineheight=g(2,'Length',lineheight,32,2048,a.setLineHeight)linespeed=linespeed or a.getLineSpeed()linespeed=g(3,'Speed',linespeed,0,500,a.setLineSpeed)colorspeed=colorspeed or a.getColorSpeed()colorspeed=g(4,'Color',colorspeed,0,600,a.setColorSpeed)b.finish()end end;function love.mousepressed(n,o,p)if p==2 then showdebug=not showdebug end end;function love.keypressed(q,r)if q=='d'then showdebug=not showdebug end;if q=='f'then if not love.window.getFullscreen()then love.window.setFullscreen(true,'desktop')else love.window.setFullscreen(false,'desktop')end end;if q=='escape'then love.event.quit()end endlocal a=({...})[1]kdraw=require(a..".kdraw")require(a..".kavarki_love")local b={}b.context={hot=0,active=0,selected=0,hitregion={},scache={},layout={},mousex=0,mousey=0,mousel=false,mousem=false,mouser=false,mousewu=false,mousewd=false,keyinputs={},keyshift=false,keyctrl=false}b.drawlist={}local function c(d)b.context.hot=d end;local function e(d)if b.context.hot==d then return true end;return false end;local function f(d)b.context.active=d end;local function g(d)if b.context.active==d then return true end;return false end;local function h(d)b.context.selected=d end;local function i(d)if b.context.selected==d then return true end;return false end;local function j()return b.context.mousex end;local function k()return b.context.mousey end;local function l()return b.context.mousel end;local function m()return b.context.mousem end;local function n()return b.context.mouser end;local function o()return b.context.mousewu end;local function p()return b.context.mousewd end;local function q()return table.remove(b.context.keyinputs,1)end;local function r()return b.context.keyshift end;local function s()return b.context.keyctrl end;local function t(d)if not b.context.scache[d]then b.context.scache[d]={}end;return b.context.scache[d]end;local function u()return b.context.layout end;local function v(w,x,y,z)if y<0 or z<0 then error("hit region cannot be less than zero")end;local A=b.context.hitregion;if#A==0 then table.insert(A,{x=w,y=x,w=y,h=z})return w,x,y,z end;local B=A[#A]x1=math.max(B.x,w)x2=math.min(B.x+B.w,w+y)y1=math.max(B.y,x)y2=math.min(B.y+B.h,x+z)nx=x1;ny=y1;nw=math.max(x2-x1,0)nh=math.max(y2-y1,0)table.insert(A,{x=nx,y=ny,w=nw,h=nh})return nx,ny,nw,nh end;local function C()local A=b.context.hitregion;if#A<1 then error("cannot release unset hit region")end;table.remove(A)end;local function D()return#b.context.hitregion>0 end;local function E(w,x,y,z)if D()then w,x,y,z=v(w,x,y,z)C()end;local F=j()local G=k()if F<=w or G<=x or F>w+y or G>x+z then return false end;return true end;local function H(w,x,y,z)if w and x then error("megafail")return w,x end;local I=u()local J=0;if not I then I={}end;if#I==0 then table.insert(I,{x=J,y=J,h=0,gh=0,gw=0})end;local K=I[#I]local L=0;local M=0;if#I>1 then L=I[#I-1].x end;if#I>1 then M=I[#I-1].y end;w=K.x+(K.offsetx or 0)x=K.y+(K.offsety or 0)K.x=K.x+y+J;if z>K.h then K.h=z end;if not K.abs then K.gw=K.x-L end;if not K.abs then K.gh=K.y+K.h-M end;return w,x end;function b.nextLine()local I=u()local J=0;local K=I[#I]local L=J;if#I>1 then L=I[#I-1].x end;K.x=L;K.y=K.y+K.h+J;K.h=0 end;function b.wpadding(w)H(nil,nil,w,0)end;function b.hpadding(w)H(nil,nil,0,w)b.nextLine()end;function b.startGroup(N)N=N or{}local I=u()local O=I[#I]local P=O.offsetx or 0;local Q=O.offsety or 0;local R=0;local S=0;local T=false;if N.w and N.h then N.x=O.x+P;N.y=O.y+Q;R=N.h;S=N.w;Q=Q+(N.oy and math.floor(N.oy)or 0)P=P+(N.ox and math.floor(N.ox)or 0)T=true;v(N.x,N.y,N.w,N.h)table.insert(b.drawlist,function()kdraw.groupstart(N)end)end;table.insert(I,{x=O.x,y=O.y,h=0,gh=R,gw=S,abs=T,offsetx=P,offsety=Q})end;function b.endGroup(N)N=N or{}N.border=N.border or false;local I=u()if#I<2 then error("A group must be started before ending.")end;local O=I[#I-1]local K=I[#I]if K.abs then C()table.insert(b.drawlist,function()kdraw.groupend(N)end)end;O.x=O.x+K.gw;O.h=K.gh;table.remove(I,#I)end;function b.start(N)b.context.mousex=N.mousex or 0;b.context.mousey=N.mousey or 0;b.context.mousel=N.mousel or false;b.context.mousem=N.mousel or false;b.context.mouser=N.mousel or false;b.context.mousewu=N.mousewu or false;b.context.mousewd=N.mousewd or false;b.context.keyinputs=N.keyinputs or{}b.context.keyshift=N.keyshift or false;b.context.keyctrl=N.keyctrl or false;b.context.layout={}end;function b.label(N)N.w=N.w or 100;N.h=N.h or 50;N.x,N.y=H(N.x,N.y,N.w,N.h)N.text=N.text or"LBL"table.insert(b.drawlist,function()kdraw.label(N)end)end;function b.button(N)N.id=N.id or error("No id has been set")N.w=N.w or 100;N.h=N.h or 50;N.x,N.y=H(N.x,N.y,N.w,N.h)N.text=N.text or"B"N.toggleable=N.toggleable or false;N.set=N.set or false;N.atpress=false;N.atrelease=false;if E(N.x,N.y,N.w,N.h)then if g(0)or g(N.id)then c(N.id)end else if g(N.id)then c(0)end end;if g(N.id)and not l()then if e(N.id)then if N.toggleable then N.set=not N.set end;N.atrelease=true;h(N.id)end;f(0)elseif e(N.id)and l()then f(N.id)end;if i(N.id)then repeat local U=q()if U=="return"or U==' 'then if N.toggleable then N.set=not N.set end;N.atrelease=true;f(N.id)end;if U=="escape"then h(0)end until U==nil end;N.hot=e(N.id)N.active=g(N.id)N.selected=i(N.id)table.insert(b.drawlist,function()kdraw.button(N)end)return N.atrelease,N.set end;function b.slider(N)N.id=N.id or error("No id has been set")if N.w and N.h and not N.hor then if N.w>N.h then N.hor=true else N.hor=false end end;N.hor=N.hor or false;N.w=N.w or(N.hor and 200 or 20)N.h=N.h or(N.hor and 20 or 200)N.x,N.y=H(N.x,N.y,N.w,N.h)N.min=N.min or 0;N.max=N.max or 100;N.val=N.val or 50;N.range=N.range or 10;N.step=N.step or 0;local K=t(N.id)K.valprev=K.valprev or N.val;K.pressx=K.pressx or 0;K.pressy=K.pressy or 0;if E(N.x,N.y,N.w,N.h)then if g(0)or g(N.id)then c(N.id)end else if g(N.id)then if not E(N.x-100,N.y-100,N.w+200,N.h+200)then c(0)N.val=K.valprev end end end;if g(N.id)and not l()then if e(N.id)then h(N.id)end;K.valprev=N.val;f(0)elseif e(N.id)and l()then if not g(N.id)then K.pressx=j()K.pressy=k()if not N.hor then if K.pressy-N.y>(N.val+N.range-N.min)*N.h/(N.max-N.min)then N.val=(K.pressy-N.y)*(N.max-N.min)/N.h+N.min-N.range end;if K.pressy-N.y<(N.val-N.min)*N.h/(N.max-N.min)then N.val=(K.pressy-N.y)*(N.max-N.min)/N.h+N.min end else if K.pressx-N.x>(N.val+N.range-N.min)*N.w/(N.max-N.min)then N.val=(K.pressx-N.x)*(N.max-N.min)/N.w+N.min-N.range end;if K.pressx-N.x<(N.val-N.min)*N.w/(N.max-N.min)then N.val=(K.pressx-N.x)*(N.max-N.min)/N.w+N.min end end;K.valprev=N.val end;f(N.id)end;if g(N.id)and e(N.id)then if not N.hor then local V=k()N.val=K.valprev+(N.max-N.min)/N.h*(V-K.pressy)else local W=j()N.val=K.valprev+(N.max-N.min)/N.w*(W-K.pressx)end;if N.step>0 then N.val=N.val-N.val%N.step end end;if i(N.id)then local X=N.step;if X==0 then X=1 end;if o()then N.val=N.val+X end;if p()then N.val=N.val-X end;repeat local U=q()if U=="escape"then h(0)end until U==nil end;if N.val<N.min then N.val=N.min end;if N.val>N.max-N.range then N.val=N.max-N.range end;if K.valprev<N.min then K.valprev=N.min end;if K.valprev>N.max-N.range then K.valprev=N.max-N.range end;N.hot=e(N.id)N.active=g(N.id)N.selected=i(N.id)table.insert(b.drawlist,function()kdraw.slider(N)end)return N.val end;function b.input(N)N.id=N.id or error("No id has been set")N.w=N.w or 100;N.h=N.h or 20;N.x,N.y=H(N.x,N.y,N.w,N.h)N.text=N.text or"Test string"N.multiline=N.multiline or false;local K=t(N.id)K.cursor=K.cursor or#N.text;N.set=N.set or false;if E(N.x,N.y,N.w,N.h)then if g(0)or g(N.id)then c(N.id)end else if g(N.id)then c(0)end end;if g(N.id)and not l()then if e(N.id)then K.cursor=kdraw.fontOffset(N.text,j()-N.x)if N.toggleable then N.set=not N.set end;h(N.id)end;f(0)elseif e(N.id)and l()then f(N.id)end;if i(N.id)then repeat local U=q()if U~=nil and#U==1 then if r()then U=string.upper(U)end;local Y=string.sub(N.text,1,K.cursor)local Z=string.sub(N.text,K.cursor+1,#N.text)N.text=Y..U..Z;K.cursor=K.cursor+1 end;if U=="return"then f(N.id)end;if U=="backspace"then local Y=string.sub(N.text,1,K.cursor-1)local Z=string.sub(N.text,K.cursor+1,#N.text)if K.cursor==0 then Y=''end;N.text=Y..Z;K.cursor=K.cursor-1 end;if U=='delete'then local Y=string.sub(N.text,1,K.cursor)local Z=string.sub(N.text,K.cursor+2,#N.text)N.text=Y..Z end;if U=='home'then K.cursor=0 end;if U=='end'then K.cursor=#N.text end;if U=='left'then if s()then local _=N.text:reverse():find('(%a)%s',#N.text-K.cursor+1)if _ then K.cursor=#N.text-_ else K.cursor=0 end else K.cursor=K.cursor-1 end end;if U=='right'then if s()then local _=string.find(N.text,'%s(%a)',K.cursor+1)if _ then K.cursor=_ else K.cursor=#N.text end else K.cursor=K.cursor+1 end end;if U=="escape"then h(0)end until U==nil;if K.cursor<0 then K.cursor=0 end;if K.cursor>#N.text then K.cursor=#N.text end end;N.hot=e(N.id)N.active=g(N.id)N.selected=i(N.id)N.cursor=K.cursor;table.insert(b.drawlist,function()kdraw.input(N)end)return N.text end;function b.finish()if l()and e(0)then h(0)end;for a0,a1 in ipairs(b.drawlist)do a1()end;b.drawlist={}if g(0)then c(0)end end;return bkdraw.font=love.graphics.newFont(10)love.graphics.setFont(kdraw.font)function kdraw.color(a)love.graphics.setColor(a)end;function kdraw.line(b,c,d,e)love.graphics.line(b,c,d,e)end;function kdraw.rectLine(f,g,h,i)love.graphics.rectangle("line",f,g,h,i)end;function kdraw.rectFill(f,g,h,i)love.graphics.rectangle("fill",f,g,h,i)end;function kdraw.polyLine(...)love.graphics.polygon("line",...)end;function kdraw.polyFill(...)love.graphics.polygon("fill",...)end;function kdraw.scissor(f,g,h,i)love.graphics.setScissor(f,g,h,i)end;function kdraw.text(j,f,g,h,k)love.graphics.setFont(kdraw.font)love.graphics.printf(j,f,g,h,k)end;function kdraw.textWidth(j)return kdraw.font:getWidth(j)end;function kdraw.textHeight()return kdraw.font:getHeight()endlocal a={}a.light={220,220,220,150}a.dark={100,100,100,150}a.selected={140,200,200}a.hot={0,200,200}a.active={0,255,255}a.scissorstack={{x=0,y=0,w=10000,h=10000}}local function b(c,d,e,f)if e<0 or f<0 then error("Scissor region cannot be less than zero")end;local g=a.scissorstack;local h=g[#g]x1=math.max(h.x,c)x2=math.min(h.x+h.w,c+e)y1=math.max(h.y,d)y2=math.min(h.y+h.h,d+f)nx=x1;ny=y1;nw=math.max(x2-x1,0)nh=math.max(y2-y1,0)table.insert(g,{x=nx,y=ny,w=nw,h=nh})a.scissor(nx,ny,nw,nh)end;local function i()local g=a.scissorstack;if#g<=1 then error("Cannot remove last scissor")end;table.remove(g)local h=g[#g]a.scissor(h.x,h.y,h.w,h.h)end;function a.fontOffset(j,c)local k=0;for l=1,#j do k=a.font:getWidth(string.sub(j,1,l))if k>c then return l-1 end end;return#j end;function a.label(m)a.text(m.text,m.x,m.y,1000)end;function a.input(m)a.color(a.dark)a.rectFill(m.x,m.y,m.w,m.h)b(m.x,m.y,m.w,m.h)a.color(a.light)if m.selected then a.color(a.selected)end;if m.hot then a.color(a.hot)end;if m.active then a.color(a.active)end;a.rectLine(m.x,m.y,m.w,m.h)local e=a.textWidth(string.sub(m.text,1,m.cursor))local n=0;if e>m.w-10 then n=e-m.w+10 end;if m.selected then a.line(m.x+e+4-n,m.y+4,m.x+e+4-n,m.y+m.h-4)end;a.color(a.light)a.text(m.text,m.x+2-n,m.y+2,1000)i()end;function a.button(m)a.color(a.dark)if m.set then a.color(a.active)end;if m.active then a.color(a.light)end;a.rectFill(m.x,m.y,m.w,m.h)a.color(a.light)if m.selected then a.color(a.selected)end;if m.hot then a.color(a.hot)end;if m.active then a.color(a.active)end;a.rectLine(m.x,m.y,m.w,m.h)a.color(a.light)if m.active then a.color(a.dark)end;a.text(m.text,m.x,m.y+m.h/2-a.textHeight()/2,m.w,"center")end;function a.slider(m)a.color(a.dark)if m.active then a.color(a.light)end;a.rectFill(m.x,m.y,m.w,m.h)a.color(a.light)if m.selected then a.color(a.selected)end;if m.hot then a.color(a.hot)end;if m.active then a.color(a.active)end;a.rectLine(m.x,m.y,m.w,m.h)if not m.hor then local o=m.h/(m.max-m.min)*m.step;if m.step>0 and o>5 then for l=o,m.h,o do a.line(m.x+4,m.y+l,m.x+m.w-4,m.y+l)end end else local o=m.w/(m.max-m.min)*m.step;if m.step>0 and o>5 then for l=o,m.w,o do a.line(m.x+l,m.y+4,m.x+l,m.y+m.h-4)end end end;a.color(a.light)if m.active then a.color(a.dark)end;if not m.hor then local d=(m.val-m.min)*m.h/(m.max-m.min)local f=m.range*m.h/(m.max-m.min)if m.range==0 then a.line(m.x-2,m.y+d,m.x+m.w+2,m.y+d)a.polyFill(m.x,m.y+d,m.x-6,m.y+d+5,m.x-6,m.y+d-5)a.polyFill(m.x+m.w,m.y+d,m.x+m.w+5,m.y+d+5,m.x+m.w+5,m.y+d-5)else a.rectFill(m.x+2,m.y+d+2,m.w-4,f-4)end end;if m.hor then local c=(m.val-m.min)*m.w/(m.max-m.min)local e=m.range*m.w/(m.max-m.min)if m.range==0 then a.line(m.x+c,m.y-2,m.x+c,m.y+m.h+2)a.polyFill(m.x+c,m.y,m.x+c-5,m.y-6,m.x+c+5,m.y-6)a.polyFill(m.x+c,m.y+m.h,m.x+c-5,m.y+m.h+5,m.x+c+5,m.y+m.h+5)else a.rectFill(m.x+c+2,m.y+2,e-4,m.h-4)end end end;function a.groupstart(m)a.color(a.dark)a.rectLine(m.x,m.y,m.w,m.h)b(m.x,m.y,m.w,m.h)end;function a.groupend(m)i()end;return a